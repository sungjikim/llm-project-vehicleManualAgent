"""
설정 및 상수 정의
"""

import os
from pathlib import Path
from dotenv import load_dotenv

# 환경 변수 로드
load_dotenv()

# 프로젝트 경로
PROJECT_ROOT = Path(__file__).parent.parent.parent
DATA_DIR = PROJECT_ROOT / "data"
CHROMA_DB_DIR = PROJECT_ROOT / "chroma_db"

# PDF 파일 경로
DEFAULT_PDF_PATH = DATA_DIR / "backup" / "kr_ko-KR_xc60_2026.pdf"

# 모델 설정
DEFAULT_LLM_MODEL = "gpt-4o-mini"
DEFAULT_LLM_TEMPERATURE = 0
DEFAULT_EMBEDDING_MODEL = "text-embedding-3-small"

# Cross-Encoder 모델
CROSS_ENCODER_MODEL = "BAAI/bge-reranker-v2-m3"

# 검색 설정
DEFAULT_TOP_K = 5
CANDIDATE_DOCS_COUNT = 20  # 재순위화를 위한 후보 문서 수
CHUNK_SIZE = 300
CHUNK_OVERLAP = 30
BATCH_SIZE = 50

# 압축 설정
SIMILARITY_THRESHOLD = 0.6  # 임베딩 필터링 임계값
REDUNDANCY_THRESHOLD = 0.9  # 중복 제거 임계값

# 검색 전략 옵션
SEARCH_OPTIONS = {
    "vector_only": "벡터 검색만 사용",
    "bm25_only": "BM25 키워드 검색만 사용", 
    "hybrid_balanced": "하이브리드 (5:5)",
    "hybrid_semantic": "하이브리드 (7:3 - 의미론적 우선)",
    "hybrid_keyword": "하이브리드 (3:7 - 키워드 우선)",
    "multi_query": "다중 쿼리 생성 검색",
    "expanded_query": "전문 용어 확장 검색",
    "cross_encoder_rerank": "Cross-Encoder 재순위화 검색",
    "contextual_compression": "맥락 압축 검색"
}

# 하이브리드 검색 가중치 설정
WEIGHT_CONFIGS = {
    "hybrid_semantic": 0.7,    # 의미론적 검색 우선
    "hybrid_balanced": 0.5,    # 균형 검색
    "hybrid_keyword": 0.3      # 키워드 검색 우선
}

# 차량 전문 용어 매핑
VEHICLE_TERMS = {
    '타이어': ['타이어', '타이어 압력', '공기압', '압력', 'PSI', 'bar', '휠', '바퀴'],
    '브레이크': ['브레이크', '제동', '제동장치', '브레이크 패드', '제동 패드', '브레이크액', '제동액'],
    '엔진': ['엔진', '모터', '동력장치', '엔진오일', '오일', '윤활유', '냉각수'],
    '경고등': ['경고등', '표시등', '인디케이터', '알림등', '경고 신호', '계기판', '대시보드'],
    '문제': ['문제', '고장', '오류', '이상', '결함', '오작동', '트러블', '장애'],
    '교체': ['교체', '교체방법', '바꾸기', '수리', '정비', '유지보수', '점검', '관리'],
    '연료': ['연료', '연료탱크', '기름', '가솔린', '디젤', '연비', '주유'],
    '배터리': ['배터리', '축전지', '전기', '충전', '방전', '전원'],
    'XC60': ['XC60', '볼보', 'VOLVO', '차량', '모델', '사양'],
    '주차': ['주차', '파킹', '자동주차', '주차보조', '주차센서'],
    '시동': ['시동', '엔진시동', '시동걸기', '점화', '스타트'],
    '사륜구동': ['사륜구동', '4WD', 'AWD', '전륜구동', '후륜구동', '구동방식']
}

# Kiwi 토크나이저 사용자 정의 단어
CUSTOM_WORDS = [
    ('볼보', 'NNP'),
    ('XC60', 'NNP'), 
    ('타이어', 'NNG'),
    ('브레이크', 'NNG'),
    ('엔진', 'NNG'),
    ('경고등', 'NNG')
]

# Few-shot 예시 데이터
VEHICLE_EXAMPLES = [
    {
        "query": "오일 교체는 언제 해야 하나요?",
        "context": "엔진 오일은 주행 거리에 따라 교체 주기가 달라집니다. 일반적으로 10,000km 또는 12개월마다 교체하는 것이 권장됩니다. 오일 교체는 볼보 공식 서비스 센터에서 실시하는 것이 좋습니다. [페이지 326-327]",
        "answer": "엔진 오일은 주행 거리 10,000km 또는 12개월마다 교체하는 것이 권장됩니다. 정확한 교체 시기는 주행 환경과 운전 습관에 따라 달라질 수 있으니, 볼보 공식 서비스 센터에서 점검받으시기 바랍니다. 안전상 주의사항으로 오일 레벨을 정기적으로 확인하시기 바랍니다.\n\n📚 참고 페이지: 326-327"
    },
    {
        "query": "브레이크가 제대로 작동하지 않는 것 같아요.",
        "context": "브레이크 시스템에 문제가 생겼을 때는 즉시 주행을 중단하고 안전한 장소에 주차해야 합니다. 브레이크 패드의 마모나 브레이크 액체 부족이 원인일 수 있습니다. 브레이크 경고등이 켜져 있는지 확인하세요. [페이지 195-196]",
        "answer": "브레이크 시스템에 이상이 있을 때는 즉시 안전한 장소에 주차하고 주행을 중단하세요. 다음 사항들을 확인해주세요:\n\n1. 브레이크 경고등 점등 여부\n2. 브레이크 페달의 느낌 변화\n3. 브레이크 액체 레벨\n\n이러한 증상들은 브레이크 패드 마모나 브레이크 액체 부족을 나타낼 수 있습니다. 안전상 주의사항으로 즉시 볼보 공식 서비스 센터에 연락하여 점검을 받으시기 바랍니다.\n\n📚 참고 페이지: 195-196"
    },
    {
        "query": "타이어 소음이 이상해요.",
        "context": "타이어에서 비정상적인 소음이 나는 경우 여러 원인이 있을 수 있습니다. 타이어 공기압 부족, 타이어 마모, 이물질 끼임 등이 주요 원인입니다. 타이어 공기압을 정기적으로 확인하고, 타이어 표면에 손상이 없는지 검사하세요. [페이지 316-321]",
        "answer": "타이어에서 비정상적인 소음이 나는 경우 다음 사항들을 확인해주세요:\n\n1. **타이어 공기압 확인**: 권장 압력에 맞게 조정\n2. **타이어 표면 검사**: 균열, 손상, 이물질 끼임 여부 확인\n3. **타이어 마모도 점검**: 트레드 깊이 확인\n\n이러한 문제들은 주행 안전에 직접적인 영향을 미칠 수 있습니다. 소음이 지속되거나 악화될 경우 즉시 전문가의 점검을 받으시기 바랍니다.\n\n📚 참고 페이지: 316-321"
    }
]
